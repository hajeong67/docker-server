{% extends "base.html" %}

{% block page_title %}
    Index Page
{% endblock page_title %}

{% block content %}
    <h1>ë¡œê·¸ì¸ ëœ í™”ë©´</h1>
    <button onclick="logout()">Logout</button>

    <h2>ğŸ” í˜„ì¬ ë¡œê·¸ì¸ ì •ë³´</h2>
    <p><strong>Access Token:</strong> <span id="accessToken"></span></p>
    <p><strong>Refresh Token:</strong> <span id="refreshToken"></span></p>

    <script>
        // ë¡œê·¸ì¸ëœ ìƒíƒœì—ì„œ JWT ì •ë³´ë¥¼ í™”ë©´ì— í‘œì‹œ
        function displayTokens() {
            let accessToken = localStorage.getItem("access_token");
            let refreshToken = localStorage.getItem("refresh_token");

            document.getElementById("accessToken").textContent = accessToken ? accessToken : "No Access Token";
            document.getElementById("refreshToken").textContent = refreshToken ? refreshToken : "No Refresh Token";
        }

        // ë¡œê·¸ì•„ì›ƒ
        async function logout() {
            let accessToken = localStorage.getItem("access_token");
            let refreshToken = localStorage.getItem("refresh_token");

            if (!accessToken || !refreshToken) {
                alert("Not logged in!");
                window.location.href = "/users/login/";
                return;
            }

            try {
                let res = await fetch("/api/users/logout/", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${accessToken}`
                    },
                    body: JSON.stringify({ refresh: refreshToken }),
                });

                let data = await res.json();

                if (res.ok) {
                    localStorage.removeItem("access_token");
                    localStorage.removeItem("refresh_token");

                    console.log("Access Token ì‚­ì œë¨:", localStorage.getItem("access_token"));
                    console.log("Refresh Token ì‚­ì œë¨:", localStorage.getItem("refresh_token"));

                    alert(data.message || "Logged out successfully!");
                    window.location.href = "/users/login/";
                } else {
                    alert(data.error || "Logout failed!");
                }
            } catch (error) {
                console.error("Error during logout:", error);
                alert("An unexpected error occurred.");
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ JWT ì •ë³´ í‘œì‹œ
        window.onload = displayTokens;
    </script>
{% endblock content %}